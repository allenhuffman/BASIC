0 REM advent2.bas
10 CLS:X=16:Y=8:RM=1

20 GOSUB 1000

30 L=1024+Y*32+X
40 IF NR=0 THEN ON RM GOSUB 1000,2000,3000,4000,5000

100 POKE L,175:LP=L
105 PRINT@480,RM;X;Y;
110 POKE&H155,&HFF:POKE&H156,&HFF:POKE&H157,&HFF:POKE&H158,&HFF
115 NR=RM:NY=Y:NX=X

120 IF PEEK(&H155)=&HF7 THEN IF Y>. THEN NY=Y-1 ELSE NR=RM(RM-1,0):NY=14:GOTO 30

130 IF PEEK(&H156)=&HF7 THEN IF Y<&HE THEN NY=Y+1 ELSE NR=RM(RM-1,1):NY=0:GOTO 30

140 IF PEEK(&H157)=&HF7 THEN IF X>. THEN NX=X-1 ELSE NR=RM(RM-1,2):NX=31:GOTO 30

150 IF PEEK(&H158)=&HF7 THEN IF X<&H1E THEN NX=X+1 ELSE NR=RM(RM-1,3):NX=0:GOTO 30

160 NL=&H400+NY*&H20+NX:IF PEEK(NL)=&H58 THEN 180

170 L=NL:X=NX:Y=NY

180 IF L<>LP THEN POKE LP,&H60

190 GOTO 100

1000 REM Room 1
1010 CLS:PRINT"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
1020 FOR A=1 TO 14
1030 PRINT"X                              X";
1040 NEXT
1060 RETURN

2000 REM Room 2
2010 CLS:PRINT"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
2020 FOR A=1 TO 13
2030 PRINT"X"
2040 NEXT
2050 PRINT"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
2060 RETURN

3000 REM Room 3
3010 CLS:PRINT"X                              X";
3020 FOR A=1 TO 13:PRINT:NEXT
3030 PRINT"X                              X";
3040 RETURN

4000 REM Room 4
4010 CLS:PRINT"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
4020 FOR A=1 TO 13
4030 PRINT"                               X";
4040 NEXT
4050 PRINT"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
4060 RETURN

5000 REM Room 5
5010 CLS:FOR A=1 TO 14
5020 PRINT"X                              X";
5030 NEXT
5040 PRINT"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
5050 RETURN

10000 REM Room state table
10005 DIM RM(4,3):FOR A=0 TO 4:FOR B=0 TO 3:READ RM(A,B):NEXT:NEXT:RETURN
10000 DATA 0,3,0,0
10010 DATA 0,0,1,3
10020 DATA 1,5,2,4
10030 DATA 0,0,3,0
10050 DATA 3,0,0,0
